{"ast":null,"code":"/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n * All rights reserved.\n *\n * This source code is licensed under the license found in the\n * LICENSE file in the root directory of this source tree.\n */import{Streamlit,withStreamlitConnection}from'streamlit-component-lib';import React,{useEffect,useMemo,useRef,useState}from'react';import*as d3 from'd3';import'./LlmViewer.css';import{jsx as _jsx}from\"react/jsx-runtime\";export const renderParams={cellH:32,cellW:32,attnSize:8,afterFfnSize:8,ffnSize:6,tokenSelectorSize:16,layerCornerRadius:6};var CellItem=/*#__PURE__*/function(CellItem){CellItem[\"AfterAttn\"]=\"after_attn\";CellItem[\"AfterFfn\"]=\"after_ffn\";CellItem[\"Ffn\"]=\"ffn\";CellItem[\"Original\"]=\"original\";return CellItem;}(CellItem||{});// They will only be at level = 0\nfunction tokenPointerPolygon(origin){const r=renderParams.tokenSelectorSize/2;const dy=r/2;const dx=r*Math.sqrt(3.0)/2;// Draw an arrow looking down\nreturn[[origin.x,origin.y+r],[origin.x+dx,origin.y-dy],[origin.x-dx,origin.y-dy]].toString();}function isSameCell(cell1,cell2){if(cell1==null||cell2==null){return false;}return cell1.layer===cell2.layer&&cell1.token===cell2.token;}function isSameNode(node1,node2){if(node1===null||node2===null){return false;}return isSameCell(node1.cell,node2.cell)&&node1.item===node2.item;}function isSameEdge(edge1,edge2){if(edge1===null||edge2===null){return false;}return isSameNode(edge1.from,edge2.from)&&isSameNode(edge1.to,edge2.to);}function nodeFromString(name){var _typeToCellItem$get;const match=name.match(/([AIMX])(\\d+)_(\\d+)/);if(match==null){return{cell:null,item:null};}const[,type,layerStr,tokenStr]=match;const layer=+layerStr;const token=+tokenStr;const typeToCellItem=new Map([['A',CellItem.AfterAttn],['I',CellItem.AfterFfn],['M',CellItem.Ffn],['X',CellItem.Original]]);return{cell:{layer:layer,token:token},item:(_typeToCellItem$get=typeToCellItem.get(type))!==null&&_typeToCellItem$get!==void 0?_typeToCellItem$get:null};}function isValidNode(node,nLayers,nTokens){if(node.cell===null){return true;}return node.cell.layer<nLayers&&node.cell.token<nTokens;}function isValidSelection(selection,nLayers,nTokens){if(selection.node!==null){return isValidNode(selection.node,nLayers,nTokens);}if(selection.edge!==null){return isValidNode(selection.edge.from,nLayers,nTokens)&&isValidNode(selection.edge.to,nLayers,nTokens);}return true;}const ContributionGraph=_ref=>{let{args}=_ref;const modelInfo=args['model_info'];const tokens=args['tokens'];const edgesRaw=args['edges_per_token'];const nLayers=modelInfo===null?0:modelInfo.n_layers;const nTokens=tokens===null?0:tokens.length;const[selection,setSelection]=useState({node:null,edge:null});var curSelection=selection;if(!isValidSelection(selection,nLayers,nTokens)){curSelection={node:null,edge:null};setSelection(curSelection);Streamlit.setComponentValue(curSelection);}const[startToken,setStartToken]=useState(nTokens-1);// We have startToken state var, but it won't be updated till next render, so use\n// this var in the current render.\nvar curStartToken=startToken;if(startToken>=nTokens){curStartToken=nTokens-1;setStartToken(curStartToken);}const handleRepresentationClick=node=>{const newSelection={node:node,edge:null};setSelection(newSelection);Streamlit.setComponentValue(newSelection);};const handleEdgeClick=edge=>{if(!edge.isSelectable){return;}const newSelection={node:edge.to,edge:edge};setSelection(newSelection);Streamlit.setComponentValue(newSelection);};const handleTokenClick=t=>{setStartToken(t);};const[xScale,yScale]=useMemo(()=>{const x=d3.scaleLinear().domain([-2,nTokens-1]).range([0,renderParams.cellW*(nTokens+2)]);const y=d3.scaleLinear().domain([-1,nLayers]).range([renderParams.cellH*(nLayers+2),0]);return[x,y];},[nLayers,nTokens]);const cells=useMemo(()=>{let result=[];for(let l=0;l<nLayers;l++){for(let t=0;t<nTokens;t++){result.push({layer:l,token:t});}}return result;},[nLayers,nTokens]);const nodeCoords=useMemo(()=>{let result=new Map();const w=renderParams.cellW;const h=renderParams.cellH;for(var cell of cells){const cx=xScale(cell.token+0.5);const cy=yScale(cell.layer-0.5);result.set(JSON.stringify({cell:cell,item:CellItem.AfterAttn}),{x:cx,y:cy+h/4});result.set(JSON.stringify({cell:cell,item:CellItem.AfterFfn}),{x:cx,y:cy-h/4});result.set(JSON.stringify({cell:cell,item:CellItem.Ffn}),{x:cx+5*w/16,y:cy});}for(let t=0;t<nTokens;t++){cell={layer:0,token:t};const cx=xScale(cell.token+0.5);const cy=yScale(cell.layer-1.0);result.set(JSON.stringify({cell:cell,item:CellItem.Original}),{x:cx,y:cy+h/4});}return result;},[cells,nTokens,xScale,yScale]);const edges=useMemo(()=>{let result=[];for(var edgeList of edgesRaw){let edgesPerStartToken=[];for(var edge of edgeList){var _nodeCoords$get,_nodeCoords$get2;const u=nodeFromString(edge.source);const v=nodeFromString(edge.target);var isSelectable=u.cell!==null&&v.cell!==null&&v.item===CellItem.AfterAttn;var isFfn=u.cell!==null&&v.cell!==null&&(u.item===CellItem.Ffn||v.item===CellItem.Ffn);edgesPerStartToken.push({weight:edge.weight,from:u,to:v,fromPos:(_nodeCoords$get=nodeCoords.get(JSON.stringify(u)))!==null&&_nodeCoords$get!==void 0?_nodeCoords$get:{'x':0,'y':0},toPos:(_nodeCoords$get2=nodeCoords.get(JSON.stringify(v)))!==null&&_nodeCoords$get2!==void 0?_nodeCoords$get2:{'x':0,'y':0},isSelectable:isSelectable,isFfn:isFfn});}result.push(edgesPerStartToken);}return result;},[edgesRaw,nodeCoords]);const activeNodes=useMemo(()=>{let result=new Set();for(var edge of edges[curStartToken]){const u=JSON.stringify(edge.from);const v=JSON.stringify(edge.to);result.add(u);result.add(v);}return result;},[edges,curStartToken]);const nodeProps=useMemo(()=>{let result=[];nodeCoords.forEach((p,node)=>{result.push({node:JSON.parse(node),pos:p,isActive:activeNodes.has(node)});});return result;},[nodeCoords,activeNodes]);const tokenLabels=useMemo(()=>{if(!tokens){return[];}return tokens.map((s,i)=>({text:s.replace(/ /g,'Â·'),pos:{x:xScale(i+0.5),y:yScale(-1.5)}}));},[tokens,xScale,yScale]);const layerLabels=useMemo(()=>{return Array.from(Array(nLayers).keys()).map(i=>({text:'L'+i,pos:{x:xScale(-0.25),y:yScale(i-0.5)}}));},[nLayers,xScale,yScale]);const tokenSelectors=useMemo(()=>{return Array.from(Array(nTokens).keys()).map(i=>[i,{x:xScale(i+0.5),y:yScale(nLayers-0.5)}]);},[nTokens,nLayers,xScale,yScale]);const totalW=xScale(nTokens+2);const totalH=yScale(-4);useEffect(()=>{Streamlit.setFrameHeight(totalH);},[totalH]);const colorScale=d3.scaleLinear([0.0,0.5,1.0],['#9eba66','darkolivegreen','darkolivegreen']);const ffnEdgeColorScale=d3.scaleLinear([0.0,0.5,1.0],['orchid','purple','purple']);const edgeWidthScale=d3.scaleLinear([0.0,0.5,1.0],[2.0,3.0,3.0]);const svgRef=useRef(null);useEffect(()=>{const getNodeStyle=(p,type)=>{if(isSameNode(p.node,curSelection.node)){return'selectable-item selection';}if(p.isActive){return'selectable-item active-'+type+'-node';}return'selectable-item inactive-node';};const svg=d3.select(svgRef.current);svg.selectAll('*').remove();svg.selectAll('layers').data(Array.from(Array(nLayers).keys()).filter(x=>x%2===1)).enter().append('rect').attr('class','layer-highlight').attr('x',xScale(-1.0)).attr('y',layer=>yScale(layer)).attr('width',xScale(nTokens+0.25)-xScale(-1.0)).attr('height',layer=>yScale(layer)-yScale(layer+1)).attr('rx',renderParams.layerCornerRadius);svg.selectAll('edges').data(edges[curStartToken]).enter().append('line').style('stroke',edge=>{if(isSameEdge(edge,curSelection.edge)){return'orange';}if(edge.isFfn){return ffnEdgeColorScale(edge.weight);}return colorScale(edge.weight);}).attr('class',edge=>edge.isSelectable?'selectable-edge':'').style('stroke-width',edge=>edgeWidthScale(edge.weight)).attr('x1',edge=>edge.fromPos.x).attr('y1',edge=>edge.fromPos.y).attr('x2',edge=>edge.toPos.x).attr('y2',edge=>edge.toPos.y).on('click',(event,edge)=>{handleEdgeClick(edge);});svg.selectAll('residual').data(nodeProps).enter().filter(p=>{return p.node.item===CellItem.AfterAttn||p.node.item===CellItem.AfterFfn;}).append('circle').attr('class',p=>getNodeStyle(p,'residual')).attr('cx',p=>p.pos.x).attr('cy',p=>p.pos.y).attr('r',renderParams.attnSize/2).on('click',(event,p)=>{handleRepresentationClick(p.node);});svg.selectAll('ffn').data(nodeProps).enter().filter(p=>p.node.item===CellItem.Ffn&&p.isActive).append('rect').attr('class',p=>getNodeStyle(p,'ffn')).attr('x',p=>p.pos.x-renderParams.ffnSize/2).attr('y',p=>p.pos.y-renderParams.ffnSize/2).attr('width',renderParams.ffnSize).attr('height',renderParams.ffnSize).on('click',(event,p)=>{handleRepresentationClick(p.node);});svg.selectAll('token_labels').data(tokenLabels).enter().append('text').attr('x',label=>label.pos.x).attr('y',label=>label.pos.y).attr('text-anchor','end').attr('dominant-baseline','middle').attr('alignment-baseline','top').attr('transform',label=>'rotate(-40, '+label.pos.x+', '+label.pos.y+')').text(label=>label.text);svg.selectAll('layer_labels').data(layerLabels).enter().append('text').attr('x',label=>label.pos.x).attr('y',label=>label.pos.y).attr('text-anchor','middle').attr('alignment-baseline','middle').text(label=>label.text);svg.selectAll('token_selectors').data(tokenSelectors).enter().append('polygon').attr('class',_ref2=>{let[i]=_ref2;return curStartToken===i?'selectable-item selection':'selectable-item token-selector';}).attr('points',_ref3=>{let[,p]=_ref3;return tokenPointerPolygon(p);}).attr('r',renderParams.tokenSelectorSize/2).on('click',(event,_ref4)=>{let[i]=_ref4;handleTokenClick(i);});},[cells,edges,nodeProps,tokenLabels,layerLabels,tokenSelectors,curStartToken,curSelection,colorScale,ffnEdgeColorScale,edgeWidthScale,nLayers,nTokens,xScale,yScale]);return/*#__PURE__*/_jsx(\"svg\",{ref:svgRef,width:totalW,height:totalH});};export default withStreamlitConnection(ContributionGraph);","map":{"version":3,"names":["Streamlit","withStreamlitConnection","React","useEffect","useMemo","useRef","useState","d3","jsx","_jsx","renderParams","cellH","cellW","attnSize","afterFfnSize","ffnSize","tokenSelectorSize","layerCornerRadius","CellItem","tokenPointerPolygon","origin","r","dy","dx","Math","sqrt","x","y","toString","isSameCell","cell1","cell2","layer","token","isSameNode","node1","node2","cell","item","isSameEdge","edge1","edge2","from","to","nodeFromString","name","_typeToCellItem$get","match","type","layerStr","tokenStr","typeToCellItem","Map","AfterAttn","AfterFfn","Ffn","Original","get","isValidNode","node","nLayers","nTokens","isValidSelection","selection","edge","ContributionGraph","_ref","args","modelInfo","tokens","edgesRaw","n_layers","length","setSelection","curSelection","setComponentValue","startToken","setStartToken","curStartToken","handleRepresentationClick","newSelection","handleEdgeClick","isSelectable","handleTokenClick","t","xScale","yScale","scaleLinear","domain","range","cells","result","l","push","nodeCoords","w","h","cx","cy","set","JSON","stringify","edges","edgeList","edgesPerStartToken","_nodeCoords$get","_nodeCoords$get2","u","source","v","target","isFfn","weight","fromPos","toPos","activeNodes","Set","add","nodeProps","forEach","p","parse","pos","isActive","has","tokenLabels","map","s","i","text","replace","layerLabels","Array","keys","tokenSelectors","totalW","totalH","setFrameHeight","colorScale","ffnEdgeColorScale","edgeWidthScale","svgRef","getNodeStyle","svg","select","current","selectAll","remove","data","filter","enter","append","attr","style","on","event","label","_ref2","_ref3","_ref4","ref","width","height"],"sources":["/oscar/home/dkang33/llm-transparency-tool-copy/llm_transparency_tool/components/frontend/src/ContributionGraph.tsx"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n * All rights reserved.\n *\n * This source code is licensed under the license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport {\n    ComponentProps,\n    Streamlit,\n    withStreamlitConnection,\n} from 'streamlit-component-lib'\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\nimport * as d3 from 'd3';\n\nimport {\n    Label,\n    Point,\n} from './common';\nimport './LlmViewer.css';\n\nexport const renderParams = {\n    cellH: 32,\n    cellW: 32,\n    attnSize: 8,\n    afterFfnSize: 8,\n    ffnSize: 6,\n    tokenSelectorSize: 16,\n    layerCornerRadius: 6,\n}\n\ninterface Cell {\n    layer: number\n    token: number\n}\n\nenum CellItem {\n    AfterAttn = 'after_attn',\n    AfterFfn = 'after_ffn',\n    Ffn = 'ffn',\n    Original = 'original',  // They will only be at level = 0\n}\n\ninterface Node {\n    cell: Cell | null\n    item: CellItem | null\n}\n\ninterface NodeProps {\n    node: Node\n    pos: Point\n    isActive: boolean\n}\n\ninterface EdgeRaw {\n    weight: number\n    source: string\n    target: string\n}\n\ninterface Edge {\n    weight: number\n    from: Node\n    to: Node\n    fromPos: Point\n    toPos: Point\n    isSelectable: boolean\n    isFfn: boolean\n}\n\ninterface Selection {\n    node: Node | null\n    edge: Edge | null\n}\n\nfunction tokenPointerPolygon(origin: Point) {\n    const r = renderParams.tokenSelectorSize / 2\n    const dy = r / 2\n    const dx = r * Math.sqrt(3.0) / 2\n    // Draw an arrow looking down\n    return [\n        [origin.x, origin.y + r],\n        [origin.x + dx, origin.y - dy],\n        [origin.x - dx, origin.y - dy],\n    ].toString()\n}\n\nfunction isSameCell(cell1: Cell | null, cell2: Cell | null) {\n    if (cell1 == null || cell2 == null) {\n        return false\n    }\n    return cell1.layer === cell2.layer && cell1.token === cell2.token\n}\n\nfunction isSameNode(node1: Node | null, node2: Node | null) {\n    if (node1 === null || node2 === null) {\n        return false\n    }\n    return isSameCell(node1.cell, node2.cell)\n        && node1.item === node2.item;\n}\n\nfunction isSameEdge(edge1: Edge | null, edge2: Edge | null) {\n    if (edge1 === null || edge2 === null) {\n        return false\n    }\n    return isSameNode(edge1.from, edge2.from) && isSameNode(edge1.to, edge2.to);\n}\n\nfunction nodeFromString(name: string) {\n    const match = name.match(/([AIMX])(\\d+)_(\\d+)/)\n    if (match == null) {\n        return {\n            cell: null,\n            item: null,\n        }\n    }\n    const [, type, layerStr, tokenStr] = match\n    const layer = +layerStr\n    const token = +tokenStr\n\n    const typeToCellItem = new Map<string, CellItem>([\n        ['A', CellItem.AfterAttn],\n        ['I', CellItem.AfterFfn],\n        ['M', CellItem.Ffn],\n        ['X', CellItem.Original],\n    ])\n    return {\n        cell: {\n            layer: layer,\n            token: token,\n        },\n        item: typeToCellItem.get(type) ?? null,\n    }\n}\n\nfunction isValidNode(node: Node, nLayers: number, nTokens: number) {\n    if (node.cell === null) {\n        return true\n    }\n    return node.cell.layer < nLayers && node.cell.token < nTokens\n}\n\nfunction isValidSelection(selection: Selection, nLayers: number, nTokens: number) {\n    if (selection.node !== null) {\n        return isValidNode(selection.node, nLayers, nTokens)\n    }\n    if (selection.edge !== null) {\n        return isValidNode(selection.edge.from, nLayers, nTokens) &&\n            isValidNode(selection.edge.to, nLayers, nTokens)\n    }\n    return true\n}\n\nconst ContributionGraph = ({ args }: ComponentProps) => {\n    const modelInfo = args['model_info']\n    const tokens = args['tokens']\n    const edgesRaw: EdgeRaw[][] = args['edges_per_token']\n\n    const nLayers = modelInfo === null ? 0 : modelInfo.n_layers\n    const nTokens = tokens === null ? 0 : tokens.length\n\n    const [selection, setSelection] = useState<Selection>({\n        node: null,\n        edge: null,\n    })\n    var curSelection = selection\n    if (!isValidSelection(selection, nLayers, nTokens)) {\n        curSelection = {\n            node: null,\n            edge: null,\n        }\n        setSelection(curSelection)\n        Streamlit.setComponentValue(curSelection)\n    }\n\n    const [startToken, setStartToken] = useState<number>(nTokens - 1)\n    // We have startToken state var, but it won't be updated till next render, so use\n    // this var in the current render.\n    var curStartToken = startToken\n    if (startToken >= nTokens) {\n        curStartToken = nTokens - 1\n        setStartToken(curStartToken)\n    }\n\n    const handleRepresentationClick = (node: Node) => {\n        const newSelection: Selection = {\n            node: node,\n            edge: null,\n        }\n        setSelection(newSelection)\n        Streamlit.setComponentValue(newSelection)\n    }\n\n    const handleEdgeClick = (edge: Edge) => {\n        if (!edge.isSelectable) {\n            return\n        }\n        const newSelection: Selection = {\n            node: edge.to,\n            edge: edge,\n        }\n        setSelection(newSelection)\n        Streamlit.setComponentValue(newSelection)\n    }\n\n    const handleTokenClick = (t: number) => {\n        setStartToken(t)\n    }\n\n    const [xScale, yScale] = useMemo(() => {\n        const x = d3.scaleLinear()\n            .domain([-2, nTokens - 1])\n            .range([0, renderParams.cellW * (nTokens + 2)])\n        const y = d3.scaleLinear()\n            .domain([-1, nLayers])\n            .range([renderParams.cellH * (nLayers + 2), 0])\n        return [x, y]\n    }, [nLayers, nTokens])\n\n    const cells = useMemo(() => {\n        let result: Cell[] = []\n        for (let l = 0; l < nLayers; l++) {\n            for (let t = 0; t < nTokens; t++) {\n                result.push({\n                    layer: l,\n                    token: t,\n                })\n            }\n        }\n        return result\n    }, [nLayers, nTokens])\n\n    const nodeCoords = useMemo(() => {\n        let result = new Map<string, Point>()\n        const w = renderParams.cellW\n        const h = renderParams.cellH\n        for (var cell of cells) {\n            const cx = xScale(cell.token + 0.5)\n            const cy = yScale(cell.layer - 0.5)\n            result.set(\n                JSON.stringify({ cell: cell, item: CellItem.AfterAttn }),\n                { x: cx, y: cy + h / 4 },\n            )\n            result.set(\n                JSON.stringify({ cell: cell, item: CellItem.AfterFfn }),\n                { x: cx, y: cy - h / 4 },\n            )\n            result.set(\n                JSON.stringify({ cell: cell, item: CellItem.Ffn }),\n                { x: cx + 5 * w / 16, y: cy },\n            )\n        }\n        for (let t = 0; t < nTokens; t++) {\n            cell = {\n                layer: 0,\n                token: t,\n            }\n            const cx = xScale(cell.token + 0.5)\n            const cy = yScale(cell.layer - 1.0)\n            result.set(\n                JSON.stringify({ cell: cell, item: CellItem.Original }),\n                { x: cx, y: cy + h / 4 },\n            )\n        }\n        return result\n    }, [cells, nTokens, xScale, yScale])\n\n    const edges: Edge[][] = useMemo(() => {\n        let result = []\n        for (var edgeList of edgesRaw) {\n            let edgesPerStartToken = []\n            for (var edge of edgeList) {\n                const u = nodeFromString(edge.source)\n                const v = nodeFromString(edge.target)\n                var isSelectable = (\n                    u.cell !== null && v.cell !== null && v.item === CellItem.AfterAttn\n                )\n                var isFfn = (\n                    u.cell !== null && v.cell !== null && (\n                        u.item === CellItem.Ffn || v.item === CellItem.Ffn\n                    )\n                )\n                edgesPerStartToken.push({\n                    weight: edge.weight,\n                    from: u,\n                    to: v,\n                    fromPos: nodeCoords.get(JSON.stringify(u)) ?? { 'x': 0, 'y': 0 },\n                    toPos: nodeCoords.get(JSON.stringify(v)) ?? { 'x': 0, 'y': 0 },\n                    isSelectable: isSelectable,\n                    isFfn: isFfn,\n                })\n            }\n            result.push(edgesPerStartToken)\n        }\n        return result\n    }, [edgesRaw, nodeCoords])\n\n    const activeNodes = useMemo(() => {\n        let result = new Set<string>()\n        for (var edge of edges[curStartToken]) {\n            const u = JSON.stringify(edge.from)\n            const v = JSON.stringify(edge.to)\n            result.add(u)\n            result.add(v)\n        }\n        return result\n    }, [edges, curStartToken])\n\n    const nodeProps = useMemo(() => {\n        let result: Array<NodeProps> = []\n        nodeCoords.forEach((p: Point, node: string) => {\n            result.push({\n                node: JSON.parse(node),\n                pos: p,\n                isActive: activeNodes.has(node),\n            })\n        })\n        return result\n    }, [nodeCoords, activeNodes])\n\n    const tokenLabels: Label[] = useMemo(() => {\n        if (!tokens) {\n            return []\n        }\n        return tokens.map((s: string, i: number) => ({\n            text: s.replace(/ /g, 'Â·'),\n            pos: {\n                x: xScale(i + 0.5),\n                y: yScale(-1.5),\n            },\n        }))\n    }, [tokens, xScale, yScale])\n\n    const layerLabels: Label[] = useMemo(() => {\n        return Array.from(Array(nLayers).keys()).map(i => ({\n            text: 'L' + i,\n            pos: {\n                x: xScale(-0.25),\n                y: yScale(i - 0.5),\n            },\n        }))\n    }, [nLayers, xScale, yScale])\n\n    const tokenSelectors: Array<[number, Point]> = useMemo(() => {\n        return Array.from(Array(nTokens).keys()).map(i => ([\n            i,\n            {\n                x: xScale(i + 0.5),\n                y: yScale(nLayers - 0.5),\n            }\n        ]))\n    }, [nTokens, nLayers, xScale, yScale])\n\n    const totalW = xScale(nTokens + 2)\n    const totalH = yScale(-4)\n    useEffect(() => {\n        Streamlit.setFrameHeight(totalH)\n    }, [totalH])\n\n    const colorScale = d3.scaleLinear(\n        [0.0, 0.5, 1.0],\n        ['#9eba66', 'darkolivegreen', 'darkolivegreen']\n    )\n    const ffnEdgeColorScale = d3.scaleLinear(\n        [0.0, 0.5, 1.0],\n        ['orchid', 'purple', 'purple']\n    )\n    const edgeWidthScale = d3.scaleLinear([0.0, 0.5, 1.0], [2.0, 3.0, 3.0])\n\n    const svgRef = useRef(null);\n\n    useEffect(() => {\n        const getNodeStyle = (p: NodeProps, type: string) => {\n            if (isSameNode(p.node, curSelection.node)) {\n                return 'selectable-item selection'\n            }\n            if (p.isActive) {\n                return 'selectable-item active-' + type + '-node'\n            }\n            return 'selectable-item inactive-node'\n        }\n\n        const svg = d3.select(svgRef.current)\n        svg.selectAll('*').remove()\n\n        svg\n            .selectAll('layers')\n            .data(Array.from(Array(nLayers).keys()).filter((x) => x % 2 === 1))\n            .enter()\n            .append('rect')\n            .attr('class', 'layer-highlight')\n            .attr('x', xScale(-1.0))\n            .attr('y', (layer) => yScale(layer))\n            .attr('width', xScale(nTokens + 0.25) - xScale(-1.0))\n            .attr('height', (layer) => yScale(layer) - yScale(layer + 1))\n            .attr('rx', renderParams.layerCornerRadius)\n\n        svg\n            .selectAll('edges')\n            .data(edges[curStartToken])\n            .enter()\n            .append('line')\n            .style('stroke', (edge: Edge) => {\n                if (isSameEdge(edge, curSelection.edge)) {\n                    return 'orange'\n                }\n                if (edge.isFfn) {\n                    return ffnEdgeColorScale(edge.weight)\n                }\n                return colorScale(edge.weight)\n            })\n            .attr('class', (edge: Edge) => edge.isSelectable ? 'selectable-edge' : '')\n            .style('stroke-width', (edge: Edge) => edgeWidthScale(edge.weight))\n            .attr('x1', (edge: Edge) => edge.fromPos.x)\n            .attr('y1', (edge: Edge) => edge.fromPos.y)\n            .attr('x2', (edge: Edge) => edge.toPos.x)\n            .attr('y2', (edge: Edge) => edge.toPos.y)\n            .on('click', (event: PointerEvent, edge) => {\n                handleEdgeClick(edge)\n            })\n\n        svg\n            .selectAll('residual')\n            .data(nodeProps)\n            .enter()\n            .filter((p) => {\n                return p.node.item === CellItem.AfterAttn\n                    || p.node.item === CellItem.AfterFfn\n            })\n            .append('circle')\n            .attr('class', (p) => getNodeStyle(p, 'residual'))\n            .attr('cx', (p) => p.pos.x)\n            .attr('cy', (p) => p.pos.y)\n            .attr('r', renderParams.attnSize / 2)\n            .on('click', (event: PointerEvent, p) => {\n                handleRepresentationClick(p.node)\n            })\n\n        svg\n            .selectAll('ffn')\n            .data(nodeProps)\n            .enter()\n            .filter((p) => p.node.item === CellItem.Ffn && p.isActive)\n            .append('rect')\n            .attr('class', (p) => getNodeStyle(p, 'ffn'))\n            .attr('x', (p) => p.pos.x - renderParams.ffnSize / 2)\n            .attr('y', (p) => p.pos.y - renderParams.ffnSize / 2)\n            .attr('width', renderParams.ffnSize)\n            .attr('height', renderParams.ffnSize)\n            .on('click', (event: PointerEvent, p) => {\n                handleRepresentationClick(p.node)\n            })\n\n        svg\n            .selectAll('token_labels')\n            .data(tokenLabels)\n            .enter()\n            .append('text')\n            .attr('x', (label: Label) => label.pos.x)\n            .attr('y', (label: Label) => label.pos.y)\n            .attr('text-anchor', 'end')\n            .attr('dominant-baseline', 'middle')\n            .attr('alignment-baseline', 'top')\n            .attr('transform', (label: Label) =>\n                'rotate(-40, ' + label.pos.x + ', ' + label.pos.y + ')')\n            .text((label: Label) => label.text)\n\n        svg\n            .selectAll('layer_labels')\n            .data(layerLabels)\n            .enter()\n            .append('text')\n            .attr('x', (label: Label) => label.pos.x)\n            .attr('y', (label: Label) => label.pos.y)\n            .attr('text-anchor', 'middle')\n            .attr('alignment-baseline', 'middle')\n            .text((label: Label) => label.text)\n\n        svg\n            .selectAll('token_selectors')\n            .data(tokenSelectors)\n            .enter()\n            .append('polygon')\n            .attr('class', ([i,]) => (\n                curStartToken === i\n                    ? 'selectable-item selection'\n                    : 'selectable-item token-selector'\n            ))\n            .attr('points', ([, p]) => tokenPointerPolygon(p))\n            .attr('r', renderParams.tokenSelectorSize / 2)\n            .on('click', (event: PointerEvent, [i,]) => {\n                handleTokenClick(i)\n            })\n    }, [\n        cells,\n        edges,\n        nodeProps,\n        tokenLabels,\n        layerLabels,\n        tokenSelectors,\n        curStartToken,\n        curSelection,\n        colorScale,\n        ffnEdgeColorScale,\n        edgeWidthScale,\n        nLayers,\n        nTokens,\n        xScale,\n        yScale\n    ])\n\n    return <svg ref={svgRef} width={totalW} height={totalH}></svg>\n}\n\nexport default withStreamlitConnection(ContributionGraph)\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}