{"ast":null,"code":"/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n * All rights reserved.\n *\n * This source code is licensed under the license found in the\n * LICENSE file in the root directory of this source tree.\n */import{Streamlit,withStreamlitConnection}from\"streamlit-component-lib\";import React,{useEffect,useMemo,useRef,useState}from'react';import*as d3 from'd3';import'./LlmViewer.css';import{jsx as _jsx}from\"react/jsx-runtime\";export const renderParams={verticalGap:24,horizontalGap:24,itemSize:8};const Selector=_ref=>{let{args}=_ref;const items=args[\"items\"];const preselected_index=args[\"preselected_index\"];const n=items.length;const[selection,setSelection]=useState(null);// Ensure the preselected element has effect only when it's a new data.\nvar args_json=JSON.stringify(args);useEffect(()=>{setSelection(preselected_index);Streamlit.setComponentValue(preselected_index);},[args_json,preselected_index]);const handleItemClick=index=>{setSelection(index);Streamlit.setComponentValue(index);};const[xScale,yScale]=useMemo(()=>{const x=d3.scaleLinear().domain([0,1]).range([0,renderParams.horizontalGap]);const y=d3.scaleLinear().domain([0,n-1]).range([0,renderParams.verticalGap*(n-1)]);return[x,y];},[n]);const itemCoords=useMemo(()=>{return Array.from(Array(n).keys()).map(i=>({x:xScale(0.5),y:yScale(i+0.5)}));},[n,xScale,yScale]);var hasTemperature=false;if(n>0){var t=items[0].temperature;hasTemperature=t!==null&&t!==undefined;}const colorScale=useMemo(()=>{var min_t=0.0;var max_t=1.0;if(hasTemperature){min_t=items[0].temperature;max_t=items[0].temperature;for(var i=0;i<n;i++){const t=items[i].temperature;min_t=Math.min(min_t,t);max_t=Math.max(max_t,t);}}const norm=d3.scaleLinear([min_t,max_t],[0.0,1.0]);const colorScale=d3.scaleSequential(d3.interpolateYlGn);return d3.scaleSequential(value=>colorScale(norm(value)));},[items,hasTemperature,n]);const totalW=100;const totalH=yScale(n);useEffect(()=>{Streamlit.setFrameHeight(totalH);},[totalH]);const svgRef=useRef(null);useEffect(()=>{const svg=d3.select(svgRef.current);svg.selectAll('*').remove();const getItemClass=index=>{var style='selectable-item ';style+=index===selection?'selection':'selector-item';return style;};const getItemColor=item=>{var _item$temperature;var t=(_item$temperature=item.temperature)!==null&&_item$temperature!==void 0?_item$temperature:0.0;return item.index===selection?'orange':colorScale(t);};var icons=svg.selectAll('items').data(Array.from(Array(n).keys())).enter().append('circle').attr('cx',i=>itemCoords[i].x).attr('cy',i=>itemCoords[i].y).attr('r',renderParams.itemSize/2).on('click',(event,i)=>{handleItemClick(items[i].index);}).attr('class',i=>getItemClass(items[i].index));if(hasTemperature){icons.style('fill',i=>getItemColor(items[i]));}svg.selectAll('labels').data(Array.from(Array(n).keys())).enter().append('text').attr('x',i=>itemCoords[i].x+renderParams.horizontalGap/2).attr('y',i=>itemCoords[i].y).attr('text-anchor','left').attr('alignment-baseline','middle').text(i=>items[i].text);},[items,n,itemCoords,selection,colorScale,hasTemperature]);return/*#__PURE__*/_jsx(\"svg\",{ref:svgRef,width:totalW,height:totalH});};export default withStreamlitConnection(Selector);","map":{"version":3,"names":["Streamlit","withStreamlitConnection","React","useEffect","useMemo","useRef","useState","d3","jsx","_jsx","renderParams","verticalGap","horizontalGap","itemSize","Selector","_ref","args","items","preselected_index","n","length","selection","setSelection","args_json","JSON","stringify","setComponentValue","handleItemClick","index","xScale","yScale","x","scaleLinear","domain","range","y","itemCoords","Array","from","keys","map","i","hasTemperature","t","temperature","undefined","colorScale","min_t","max_t","Math","min","max","norm","scaleSequential","interpolateYlGn","value","totalW","totalH","setFrameHeight","svgRef","svg","select","current","selectAll","remove","getItemClass","style","getItemColor","item","_item$temperature","icons","data","enter","append","attr","on","event","text","ref","width","height"],"sources":["/oscar/home/dkang33/llm-transparency-tool-copy/llm_transparency_tool/components/frontend/src/Selector.tsx"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n * All rights reserved.\n *\n * This source code is licensed under the license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport {\n    ComponentProps,\n    Streamlit,\n    withStreamlitConnection,\n} from \"streamlit-component-lib\"\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\nimport * as d3 from 'd3';\n\nimport {\n    Point,\n} from './common';\nimport './LlmViewer.css';\n\nexport const renderParams = {\n    verticalGap: 24,\n    horizontalGap: 24,\n    itemSize: 8,\n}\n\ninterface Item {\n    index: number\n    text: string\n    temperature: number\n}\n\nconst Selector = ({ args }: ComponentProps) => {\n    const items: Item[] = args[\"items\"]\n    const preselected_index: number | null = args[\"preselected_index\"]\n    const n = items.length\n\n    const [selection, setSelection] = useState<number | null>(null)\n\n    // Ensure the preselected element has effect only when it's a new data.\n    var args_json = JSON.stringify(args)\n    useEffect(() => {\n        setSelection(preselected_index)\n        Streamlit.setComponentValue(preselected_index)\n    }, [args_json, preselected_index]);\n\n    const handleItemClick = (index: number) => {\n        setSelection(index)\n        Streamlit.setComponentValue(index)\n    }\n\n    const [xScale, yScale] = useMemo(() => {\n        const x = d3.scaleLinear()\n            .domain([0, 1])\n            .range([0, renderParams.horizontalGap])\n        const y = d3.scaleLinear()\n            .domain([0, n - 1])\n            .range([0, renderParams.verticalGap * (n - 1)])\n        return [x, y]\n    }, [n])\n\n    const itemCoords: Point[] = useMemo(() => {\n        return Array.from(Array(n).keys()).map(i => ({\n            x: xScale(0.5),\n            y: yScale(i + 0.5),\n        }))\n    }, [n, xScale, yScale])\n\n    var hasTemperature = false\n    if (n > 0) {\n        var t = items[0].temperature\n        hasTemperature = (t !== null && t !== undefined)\n    }\n    const colorScale = useMemo(() => {\n        var min_t = 0.0\n        var max_t = 1.0\n        if (hasTemperature) {\n            min_t = items[0].temperature\n            max_t = items[0].temperature\n            for (var i = 0; i < n; i++) {\n                const t = items[i].temperature\n                min_t = Math.min(min_t, t)\n                max_t = Math.max(max_t, t)\n            }\n        }\n        const norm = d3.scaleLinear([min_t, max_t], [0.0, 1.0])\n        const colorScale = d3.scaleSequential(d3.interpolateYlGn);\n        return d3.scaleSequential(value => colorScale(norm(value)))\n    }, [items, hasTemperature, n])\n\n    const totalW = 100\n    const totalH = yScale(n)\n    useEffect(() => {\n        Streamlit.setFrameHeight(totalH)\n    }, [totalH])\n\n    const svgRef = useRef(null);\n\n    useEffect(() => {\n        const svg = d3.select(svgRef.current)\n        svg.selectAll('*').remove()\n\n        const getItemClass = (index: number) => {\n            var style = 'selectable-item '\n            style += index === selection ? 'selection' : 'selector-item'\n            return style\n        }\n\n        const getItemColor = (item: Item) => {\n            var t = item.temperature ?? 0.0\n            return item.index === selection ? 'orange' : colorScale(t)\n        }\n\n        var icons = svg\n            .selectAll('items')\n            .data(Array.from(Array(n).keys()))\n            .enter()\n            .append('circle')\n            .attr('cx', (i) => itemCoords[i].x)\n            .attr('cy', (i) => itemCoords[i].y)\n            .attr('r', renderParams.itemSize / 2)\n            .on('click', (event: PointerEvent, i) => {\n                handleItemClick(items[i].index)\n            })\n            .attr('class', (i) => getItemClass(items[i].index))\n        if (hasTemperature) {\n            icons.style('fill', (i) => getItemColor(items[i]))\n        }\n\n        svg\n            .selectAll('labels')\n            .data(Array.from(Array(n).keys()))\n            .enter()\n            .append('text')\n            .attr('x', (i) => itemCoords[i].x + renderParams.horizontalGap / 2)\n            .attr('y', (i) => itemCoords[i].y)\n            .attr('text-anchor', 'left')\n            .attr('alignment-baseline', 'middle')\n            .text((i) => items[i].text)\n\n    }, [\n        items,\n        n,\n        itemCoords,\n        selection,\n        colorScale,\n        hasTemperature,\n    ])\n\n    return <svg ref={svgRef} width={totalW} height={totalH}></svg>\n}\n\nexport default withStreamlitConnection(Selector)\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}